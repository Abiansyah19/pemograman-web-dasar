<style>
  #kodeb option:first-child{
    display: none;
  }
  .kar option:first-child{
    display: none;
  }
  .jab option:first-child{
    display: none;
  }
</style>


<button type="button" class="insert btn btn-warning" data-bs-toggle="modal" data-bs-target="#myModal">
  +
 </button>

 <h1>pembelian</h1>

<!-- The Modal -->
<div class="modal" id="myModal">
  <div class="modal-dialog">
  <div class="modal-content">
  <!-- Modal Header -->
  <div class="modal-header">
  <h1 class="modal-title">Input</h1>
  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
  </div>

  <!-- Modal body -->
  <div class="modal-body">
 <div class="mb-3 mt-3">
  <label class="form-label">Kode Barang:</label>
 <select name="kode" id="kodeb" class="form-select">
         <option value="" selected></option>
         <option value="m001">m001</option>
         <option value="m002">m002</option>
         <option value="m003">m003</option>
       </select>
 <label class="form-label">Nama:</label>
 <input type="text" name="nama" id="nama" class="form-control" /* tambahkan lg untuk besar dan sm untuk kecil inputan*/>
 <label class="form-label">Satuan:</label>
 <input type="text" name="satuan" id="satuan" class="form-control" /* tambahkan lg untuk besar dan sm untuk kecil inputan*/>
 <label class="form-label">Harga:</label>
 <input type="text" name="harga" id="harga" class="form-control" /* tambahkan lg untuk besar dan sm untuk kecil inputan*/>
 <label class="form-label">Jumlah:</label>
 <input type="text" name="jumlah" id="jumlah" class="form-control" /* tambahkan lg untuk besar dan sm untuk kecil inputan*/>
 <br>
     <button type="button" class="btn btn-warning btn" id="save">save</button>
     <button type="button" class="btn btn-warning btn" id="update">update</button>
  </div>
 
  </div>
  <!-- Modal footer -->
  <div class="modal-footer">
  <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Close</button>
  </div>
  </div>
  </div>
 </div>

  <!-- The Modal -->
<div class="modal" id="myModal2">
  <div class="modal-dialog">
  <div class="modal-content">
  <!-- Modal Header -->
  <div class="modal-header">
  <h4 class="modal-title">WARING</h4>
  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
  </div>
  <!-- Modal body -->
  <div class="modal-body">
  <label class="form-label">Apakah anda yakin ?</label>
  <br>
  <button type="button" class="remova btn btn-warning" id="yes" data-bs-dismiss="modal">Yes</button>
  <button type="button" class="btn btn-warning" data-bs-dismiss="modal">No</button>
  </div>
  <!-- Modal footer -->
  <div class="modal-footer">
  <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
  </div>
  </div>
  </div>
 </div>
  <form>
  <label for="kode" class="form-label">kode</label> 
  <br>
<input type="text" id="kode" class="kode form-control" readonly class="form-control"> 
  <br><br>
  <label for="tgl" class="form-label">Tanggal</label> 
  <br><br>
  <input type="text" id="tgl" class="form-control" readonly>
  <br><br>
  <label for="supp" class="form-label">Supplier</label>
  <br><br>
  <select name="Supplier" id="Supplier" class="kar form-select">
  <option value="" selected></option>
  <option value="Muhammad">Muhammad</option>
  <option value="Maulana">Maulana</option>
  <option value="Ansyah">Ansyah</option>
  </select>
  <br><br>
  <label for="telp" class="form-label">Telp</label>
  <br><br>
  <input type="text" name="telp" id="Telp" class="form-control" readonly>
  <br><br>
  <label for="alamat" class="form-label">alamat</label>
    <br><br>
  <input type="text" name="Alamat" id="Alamat" class="form-control" readonly>
  <br><br>
<label for="Karyawan" id="lblk" class="form-label">karyawan</label>
<br>
  <select name="Karyawan" id="Karyawan" class="kar form-select">
    <option value="" selected></option>
    <option value="Haris">Haris</option>
    <option value="Koliq">Koliq</option>
    <option value="Abi">Abi</option>
  </select>
<br><br>
<label for="jabatan" id="lblj" class="form-label">jabatan</label>
<input type="text" id="Jabatan" class="form-control" readonly>
<br><br>
</form>
<table class="table" id="mytable">
  <thead>
    <tr>
      <td>kode</td>
      <td>nama</td>
      <td>satuan</td>
      <td>harga</td>
      <td>jumlah</td>
      <td>total harga</td>
      <td>action</td>
    </tr>
  </thead>
  <tbody id="tbody">
  </tbody>
</table>
<label>Total :</label><label id="total">0</label>
<script>
  $(document).ready(function(){
    var total=0;
    //ambil tanngal//
    var date = new Date();
    var year = date.getFullYear();
    var month = date.getMonth() + 1;
    var day = date.getDate();
    var hour = date.getHours();
    var minute = date.getMinutes();
    var second = date.getSeconds();
    //var kode dan tanggal//
    $('#kode').val(year+""+month+""+day+""+hour+""+minute+""+second);
    $('#tgl').val(day+"-"+month+"-"+year);
    console.log(day);
  
  
    $("#Supplier").change(function(){
      if($("#Supplier").val()=="Muhammad"){
      $("#Telp").val("081259959014");
      $("#Alamat").val("pondok maritim");
      }else if($("#Supplier").val()=="Maulana"){
      $("#Telp").val("081234567891");
      $("#Alamat").val("pondok rotan");     
      }else if($("#Supplier").val()=="Ansyah"){
      $("#Telp").val("081987654321");
      $("#Alamat").val("pondok mandala");
      }
    });

    $("#Karyawan").change(function(){
      if($("#Karyawan").val()=="Haris"){
      $("#Jabatan").val("Manager Sales");
      }else if($("#Karyawan").val()=="Koliq"){
      $("#Jabatan").val("Sales 1");
      }else if($("#Karyawan").val()=="Abi"){
      $("#Jabatan").val("Sales 2");
      }
    });

    //if else kode barang untuk munculkan nama satuan harga//
    $("#kodeb").change(function(){
      console.log("hello");
      if($("#kodeb").val()=="m001"){
        $("#nama").val("cpu");
        $("#satuan").val("pcs");
        $("#harga").val("200");
      }else if($("#kodeb").val()=="m002"){
        $("#nama").val("vga");
        $("#satuan").val("pcs");
        $("#harga").val("400");
      }else if($("#kodeb").val()=="m003"){
        $("#nama").val("ram");
        $("#satuan").val("pcs");
        $("#harga").val("300");
      } 
    });
    //logika tombol simpan untuk masukkan ke table

    //buat tekan insert menghilangkan tombol update
$(".insert").click(function(){
  $("#save").show();
	$("#update").hide();
});
//buat save
    $("#save").click(function(){
      total = 0;
      var panjang = $('tbody tr').length;
      var kode = $('#kodeb').val();
      var nama = $('#nama').val();
      var satuan = $('#satuan').val();
      var harga =$('#harga').val();
      var jumlah = $('#jumlah').val();
      var totalhrg = harga*jumlah;
      $('#tbody').append("<tr><td>"+kode+"</td><td>"+nama+"</td><td>"+satuan+"</td><td>"+harga+"</td><td>"+jumlah+"</td><td>"+totalhrg+"</td><td><button type=\"button\" id=\"id1"+panjang+"\" class = \"update btn btn-warning\" data-bs-toggle = \"modal\" data-bs-target=\"#myModal\" >u</td><td><button type=\"button\" id=\"id"+panjang+"\" class = \"remove btn btn-warning\" data-bs-toggle = \"modal\" data-bs-target=\"#myModal2\" >x</td></tr>")
        console.log(panjang);
      $('#tbody tr').each(function(){
        var currentRow=$(this);
        total=total + Number(currentRow.find("td:eq(5)").text());
      });
      $("#total").text(total);
      
    });
    //memanggil function hapus dan update
    $(document).ready(function(){
      $.fn.updateBarang();
      $.fn.removeFunc();
    });
    
  //function update
  var indexUpdate;
  const myModal = $("#myModal");
  $.fn.updateBarang = function () {
					let el;
					let elRow;
					let elKode;
					let elNama;
					let elGol;
					let elSat;
					let elHrg;
          let eltotalhrg;
          

					$("#mytable tbody").on("click",".update",function (){
            
						console.log("hello");
            myModal.find("h1").text("Update Barang");
						$("#save").hide();
						$("#update").show();
						indexUpdate = $(this).closest("tr").index();
						// console.log(indexUpdate);

						// cari tr
						console.log(indexUpdate);
						el = $("#mytable tbody").find("tr").eq(indexUpdate);
						// console.log(el);
						elRow = el.find("td");
						// console.log(elRow);

						// ambil semua value dari cell
						const kodeb = elRow[0].innerHTML;
						const nama = elRow[1].innerHTML;
						const satuan = elRow[2].innerHTML;
						const harga = elRow[3].innerHTML;
						const jumlah = elRow[4].innerHTML;
            const totalhrg = elRow[5].innerHTML;
            

						// ambil modal
						const modal = $("#myModal");

						// cari dan setting value dari form
						elKode = modal.find("#kodeb");
						elNama = modal.find("#nama");
						elGol = modal.find("#satuan");
						elSat = modal.find("#harga");
						elHrg = modal.find("#jumlah");
            


            //nilai masuk
						elKode.val(kodeb);
						elNama.val(nama);
						elGol.val(satuan);
						elSat.val(harga);
						elHrg.val(jumlah);
            
            
					});

					$("#update").click(function () {
						elRow[0].innerHTML = elKode.val();
						elRow[1].innerHTML = elNama.val();
						elRow[2].innerHTML = elGol.val();
						elRow[3].innerHTML = elSat.val();
						elRow[4].innerHTML = elHrg.val();
            eltotalhrg = elSat.val()*elHrg.val();
            elRow[5].innerHTML = eltotalhrg;
            
            console.log(elKode.val());
            console.log(eltotalhrg);
            

					});
				};
        //function remove
        $.fn.removeFunc = function () {
					$("#mytable tbody").on("click", ".remove", function () {
						indexUpdate = $(this).closest("tr").index();
						console.log(indexUpdate);
					});
					$(".remova").click(function () {
						$("#mytable tbody").find("tr").eq(indexUpdate).remove();
					});
				};
  
  //membuat selected box tanpa mengisi di html dan ini dapat membuat selected box null tapi tidak ada di dropdown tanpa css//
  
  //   // Mendapatkan referensi elemen select
  //   var selectBox = $("#selectBox");

  //   // Menambahkan opsi ke elemen select
  //   selectBox.append($("<option>").attr("value", "option1").text("Option 1"));
  //   selectBox.append($("<option>").attr("value", "option2").text("Option 2"));
  //   selectBox.append($("<option>").attr("value", "option3").text("Option 3"));

  //   // Menetapkan nilai default
  //   selectBox.val("option1");
  // });
  
});
</script>
